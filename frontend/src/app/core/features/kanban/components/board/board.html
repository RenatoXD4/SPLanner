<div class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white flex">
  <app-sidebar></app-sidebar>
  <app-task-detail 
    [task]="selectedTask" 
    [isHidden]="isDetailPanelHidden"
    [estadoNombre]="selectedTaskEstadoNombre"   (closePanel)="hideTaskDetails()">
  </app-task-detail>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="flex-1 p-4">
    <!-- Filtro de vistas -->
    <div class="flex flex-wrap justify-start gap-4 mb-6">
      <!-- Botón Vista Kanban -->
      <button title="Cambiar a la vista Kanban" (click)="setViewMode('kanban')" [ngClass]="getButtonClasses('kanban')"
        class="btn btn-outline border-gray-300 text-gray-700 hover:bg-primary hover:text-white hover:border-primary focus:outline-none w-full sm:w-auto transform transition-all duration-300 ease-in-out hover:scale-105">
        <span class="text-lg font-semibold">Vista Kanban</span>
      </button>

      <!-- Botón Vista Lista -->
      <button title="Cambiar a la vista en forma de lista" (click)="setViewMode('list')"
        [ngClass]="getButtonClasses('list')"
        class="btn btn-outline border-gray-300 text-gray-700 hover:bg-primary hover:text-white hover:border-primary focus:outline-none w-full sm:w-auto transform transition-all duration-300 ease-in-out hover:scale-105">
        Vista Lista
      </button>

      <!-- Botón Tareas Asignadas -->
      <button title="Aquí puedes ver tus tareas asignadas" (click)="setViewMode('assigned')"
        [ngClass]="getButtonClasses('assigned')"
        class="btn btn-outline border-gray-300 text-gray-700 hover:bg-primary hover:text-white hover:border-primary focus:outline-none w-full sm:w-auto transform transition-all duration-300 ease-in-out hover:scale-105">
        Tareas Asignadas
      </button>
    </div>

    <!-- VISTA KANBAN -->
    @if (viewMode === 'kanban') {
    <div #kanbanContainer class="flex flex-col w-full gap-6 md:flex-row">
      @for (item of CategoriasK; track item.id) {
      <div class="w-full md:w-[300px] flex-shrink-0 rounded-lg shadow-md p-4 space-y-4"
        [ngClass]="getColumnColorClass(item.nombre)">
        <!-- Título -->
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold whitespace-normal text-ellipsis break-words max-w-full overflow-hidden"
            [ngClass]="getTextColorClass(item.nombre)">
            {{ item.nombre }}
          </h2>
          <span class="badge badge-neutral animate-bounce animate-duration-1000">
            {{ item.tasks.length }}
          </span>
        </div>

        <!-- Lista de tareas -->
        <div cdkDropList [id]="item.id" [cdkDropListData]="item.tasks" [cdkDropListConnectedTo]="categoriasIds"
          (cdkDropListDropped)="drop($event)"
          class="space-y-3 min-h-[50px] max-h-[450px] overflow-y-auto rounded-lg p-1">
          @for (A of item.tasks; track A.id) {
          <div cdkDrag (cdkDragStarted)="onDragStarted()" (cdkDragEnded)="onDragEnded()"
            (mouseenter)="onTaskHover(A.id.toString())" (mouseleave)="onTaskHoverLeave(A.id.toString())"
            class="relative rounded-lg p-3 flex flex-col gap-1 border group hover:shadow-md hover:ring hover:ring-primary"
            [ngClass]="[
              'border-base-300',
              hoveredTaskId === A.id.toString()
                ? 'ring ring-primary ring-offset-2 scale-[1.01] bg-base-100 shadow-md'
                : ''
            ]" (click)="showTaskDetails(A, item)">
            <!-- Contenido principal de la tarea -->
            <span class="font-medium text-sm text-base-content break-words max-w-full">
              {{ A.title ?? '' }}
            </span>

            <span class="text-sm">
              {{ getNombreResponsables(A.assignee ?? []) }}
            </span>

            <!-- Mostrar las etiquetas asociadas a la tarea -->
            @if (A.etiquetas && A.etiquetas.length > 0) {
            <div>
              @for (nombreEtiqueta of getNombresEtiquetas(A.etiquetas); track nombreEtiqueta) {
              <span class="badge" [ngClass]="{
                  Alta: nombreEtiqueta === 'Alta',
                  Media: nombreEtiqueta === 'Media',
                  Baja: nombreEtiqueta === 'Baja'
                }">
                {{ nombreEtiqueta }}
              </span>
              }
            </div>
            }

            <!-- Ubicación de los iconos "Urgente" y "Vencida" al final -->
            @if (isOverdue(A.dueDate)) {
            <div class="flex justify-start items-center mt-2 space-x-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                  d="M9 12h6m-3-3v6M4.5 12a7.5 7.5 0 1115 0 7.5 7.5 0 01-15 0z" />
              </svg>
              <span class="text-red-500 text-sm">Vencida</span>
            </div>
            } @else if (isDueSoon(A.dueDate)) {
            <div class="flex justify-start items-center mt-2 space-x-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-orange-500" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                  d="M9 12h6m-3-3v6M4.5 12a7.5 7.5 0 1115 0 7.5 7.5 0 01-15 0z" />
              </svg>
              <span class="text-orange-500 text-sm">Urgente</span>
            </div>
            }

            <!-- Botones de Edición y Eliminación al final -->
            @if (hoveredTaskId === A.id.toString()) {
            <div class="absolute bottom-0 left-0 w-full flex justify-end gap-2 p-2">
              <button
                class="p-2 rounded-full bg-opacity-60 bg-gray-800 text-white hover:bg-opacity-80 hover:bg-blue-600 transition-opacity duration-200 ease-in-out"
                (click)="editarTarea(A.id)" aria-label="Editar tarea" style="box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15)">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                  stroke="currentColor" class="h-5 w-5">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M13.125 6.375l4.5 4.5m0 0l-7.5 7.5h-4.5v-4.5l7.5-7.5m0 0l2.25-2.25a1.125 1.125 0 0 1 1.594 1.594L13.125 6.375z" />
                </svg>
              </button>

              <button
                class="p-2 rounded-full bg-opacity-60 bg-gray-800 text-white hover:bg-opacity-80 hover:bg-red-600 transition-opacity duration-200 ease-in-out"
                (click)="eliminarTarea(A.id)" aria-label="Eliminar tarea"
                style="box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15)">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                  stroke="currentColor" class="h-5 w-5">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                </svg>
              </button>
            </div>
            }
          </div>
          }
        </div>

        <!-- Botón Nueva Tarea -->
        <button class="btn btn-sm w-full font-medium transition hover:scale-105"
          [ngClass]="getButtonColorClass(item.nombre)" (click)="abrirModal(item)">
          + Nueva Tarea
        </button>
      </div>
      }
    </div>

    }

    <!-- VISTA LISTA -->
    @if (viewMode === 'list') {
    <div #listContainer class="flex flex-col w-full gap-6 animate-fadeIn transition-opacity duration-500 ease-in-out">
      <!-- Encabezado y botón de filtros -->
      <div class="mb-4 flex justify-start items-center gap-4">
        <!-- Botón Filtros -->
        <div class="relative">
          <button (click)="mostrarPanelFiltros = !mostrarPanelFiltros" [attr.aria-pressed]="mostrarPanelFiltros"
            class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white px-4 py-2 rounded-lg flex items-center gap-3 hover:from-blue-700 hover:to-indigo-800 transition duration-300 text-sm">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
              stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
            Filtros @if (contadorFiltros > 0) {
            <span class="ml-3 bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full">
              {{ contadorFiltros }}
            </span>
            }
          </button>

          <!-- Panel de filtros y campos solo visibles cuando se interactúa -->
          @if (mostrarPanelFiltros) {
          <div class="mt-4 flex flex-col gap-6 relative">
            <!-- Buscador y listado filtros -->
            <div class="flex items-center gap-4">
              <!-- Campo de búsqueda -->
              <input *ngIf="mostrarPanelFiltros" type="text" [(ngModel)]="filtroTitulo"
                class="input input-bordered w-full sm:w-80 bg-gray-800 text-white text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"
                placeholder="Buscar por título" />

              <div class="flex gap-2">
                <!-- Botón + Filtros -->
                <button (click)="mostrarListadoFiltros = !mostrarListadoFiltros"
                  class="btn btn-xs bg-gray-700 text-white hover:bg-gray-600 active:bg-gray-500 rounded-lg focus:ring-2 focus:ring-blue-500 transition duration-200">
                  + Filtros
                </button>
              </div>
            </div>

            <!-- Filtros desplegables -->
            @if (mostrarListadoFiltros) {
            <div
              class="absolute w-64 max-h-60 overflow-y-auto bg-gray-900 border border-gray-700 rounded-lg shadow-xl z-50 mt-2 left-1/2 transform -translate-x-1/2"
              (click)="$event.stopPropagation()">
              <input type="text" [(ngModel)]="textoFiltro"
                class="input input-bordered w-full rounded-t-lg bg-gray-800 text-white text-sm"
                placeholder="Buscar filtro..." />
              <ul class="text-sm max-h-40 overflow-auto">
                <!-- Filtros dinámicos -->
                @if (!filtrosSeleccionados.includes('responsable') && (!textoFiltro ||
                'responsable'.includes(textoFiltro))) {
                <li>
                  <button (click)="agregarFiltro('responsable')"
                    class="w-full text-left px-4 py-2 hover:bg-blue-600 transition duration-200">
                    Responsable
                  </button>
                </li>
                } @if (!filtrosSeleccionados.includes('categoria') && (!textoFiltro ||
                'categoria'.includes(textoFiltro))) {
                <li>
                  <button (click)="agregarFiltro('categoria')"
                    class="w-full text-left px-4 py-2 hover:bg-blue-600 transition duration-200">
                    Categoría
                  </button>
                </li>
                } @if (!filtrosSeleccionados.includes('etiquetas') && (!textoFiltro ||
                'etiquetas'.includes(textoFiltro))) {
                <li>
                  <button (click)="agregarFiltro('etiquetas')"
                    class="w-full text-left px-4 py-2 hover:bg-blue-600 transition duration-200">
                    Etiquetas
                  </button>
                </li>
                } @if (filtrosSeleccionados.length >= 3 || (textoFiltro &&
                !'responsablecategoriaetiquetas'.includes(textoFiltro))) {
                <li class="px-4 py-3 text-center text-gray-400">Sin filtros disponibles</li>
                }
              </ul>
            </div>
            }

            <!-- Botones de filtros seleccionados -->
            <div class="flex flex-wrap gap-3">
              @for (filtro of filtrosSeleccionados; track filtro) {
              <div class="relative">
                <button (click)="toggleTarjetaFiltro(filtro)"
                  class="btn btn-sm btn-primary text-white text-xs flex items-center gap-2">
                  {{ filtro | titlecase }}
                  <span class="ml-2 bg-red-500 text-white text-[10px] font-bold px-1 rounded"
                    *ngIf="getContadorFiltro(filtro) > 0">
                    {{ getContadorFiltro(filtro) }}
                  </span>

                  <svg (click)="quitarFiltro(filtro); $event.stopPropagation()" xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4 ml-2 cursor-pointer" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                    stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>

                @if (filtroActivo === filtro) {

                <div #tarjetaFiltro
                  class="absolute z-40 mt-2 w-72 p-4 bg-gray-900 rounded-lg border border-gray-700 shadow-xl"
                  (click)="$event.stopPropagation()">
                  <input type="text" placeholder="Buscar {{ filtro }}" [(ngModel)]="buscadorFiltros[filtro]"
                    class="input input-bordered w-full mb-3 bg-gray-800 text-white text-sm" />

                  <!-- Selector de modo incluir/excluir -->
                  <div class="mb-3 text-xs text-gray-300 flex items-center gap-2">
                    <span class="font-medium">Modo:</span>
                    <button class="btn btn-xs btn-info" (click)="
                        filtroModo[filtro] =
                          filtroModo[filtro] === 'incluir' ? 'excluir' : 'incluir'
                      ">
                      {{ filtroModo[filtro] === 'incluir' ? 'Incluir' : 'Excluir' }}
                    </button>
                  </div>

                  <ul class="max-h-48 overflow-auto text-sm text-white">
                    <!-- Filtro Responsable -->
                    @if (filtro === 'responsable') { @if (responsablesFiltrados.length > 0) { @for
                    (r of responsablesFiltrados; track r.usuario.id) {
                    <li
                      class="py-2 px-3 hover:bg-blue-700 cursor-pointer rounded-lg flex justify-between items-center transition duration-200 ease-in-out"
                      (click)="seleccionarResponsable(r)">
                      <label class="flex items-center gap-2 w-full cursor-pointer">
                        <input type="checkbox" [checked]="filtroResponsable.includes(r.usuario.id)"
                          (change)="seleccionarResponsable(r)"
                          class="cursor-pointer rounded border-gray-600 bg-gray-800 hover:bg-gray-700 focus:ring-2 focus:ring-blue-500" />
                        <span class="text-gray-200">{{ r.usuario.nombre }} {{ r.usuario.apellido }}</span>
                      </label>
                    </li>
                    } } @else {
                    <li class="py-3 px-3 text-gray-400 text-sm italic">
                      Sin responsables disponibles
                    </li>
                    } }

                    <!-- Filtro Categoría -->
                    @if (filtro === 'categoria') { @if (categoriasFiltradas.length > 0) { @for (c of
                    categoriasFiltradas; track c.id) {
                    <li
                      class="py-2 px-3 hover:bg-blue-700 cursor-pointer rounded-lg flex justify-between items-center transition duration-200 ease-in-out">
                      <label class="flex items-center gap-2 w-full cursor-pointer">
                        <input type="checkbox" [checked]="filtroCategoria.includes(c.id)"
                          (change)="seleccionarCategoria(c.id)"
                          class="cursor-pointer rounded border-gray-600 bg-gray-800 hover:bg-gray-700 focus:ring-2 focus:ring-blue-500" />
                        <span class="text-gray-200">{{ c.nombre }}</span>
                      </label>
                    </li>
                    } } @else {
                    <li class="py-3 px-3 text-gray-400 text-sm italic">
                      Sin categorías disponibles
                    </li>
                    } }

                    <!-- Filtro Etiquetas -->
                    @if (filtro === 'etiquetas') { @if (etiquetasFiltradas.length > 0) { @for (e of
                    etiquetasFiltradas; track e.id) {
                    <li
                      class="py-2 px-3 hover:bg-blue-700 cursor-pointer rounded-lg flex justify-between items-center transition duration-200 ease-in-out">
                      <label class="flex items-center gap-2 w-full cursor-pointer">
                        <input type="checkbox" [checked]="filtroEtiquetas.includes(e.id)"
                          (change)="toggleEtiqueta(e.id)" (click)="$event.stopPropagation()"
                          class="cursor-pointer rounded border-gray-600 bg-gray-800 hover:bg-gray-700 focus:ring-2 focus:ring-blue-500" />
                        <span class="text-gray-200">{{ e.nombre }}</span>
                      </label>
                    </li>
                    } } @else {
                    <li class="py-3 px-3 text-gray-400 text-sm italic">
                      Sin etiquetas disponibles
                    </li>
                    } }
                  </ul>
                </div>
                }
              </div>

              }
            </div>
          </div>
          }
        </div>
        <!-- Botón Limpiar Filtros (pequeño) -->
        @if (contadorFiltros > 0) {
        <button (click)="limpiarFiltros()"
          class="ml-4 bg-red-600 text-white px-2 py-1 rounded-lg text-xs focus:ring-2 focus:ring-blue-500 transition duration-200"
          aria-label="Limpiar filtros">
          Limpiar filtros
        </button>
        }
      </div>

      <!-- Tabla de tareas -->
      <div class="w-full overflow-x-auto rounded-xl shadow-md border border-base-300 bg-base-100">
        <div class="overflow-y-auto max-h-screen">
          <!-- Agregar scroll vertical con max-height -->
          <table class="table table-zebra bg-base-200 rounded-xl text-sm animate-fadeIn">
            <thead class="bg-primary text-primary-content text-xs uppercase select-none">
              <tr>
                <th class="px-4 py-3 text-left resize-x overflow-auto min-w-[120px]">Título</th>
                <th class="px-4 py-3 text-left resize-x overflow-auto min-w-[160px]">
                  Responsables
                </th>
                <th class="px-4 py-3 text-left resize-x overflow-auto min-w-[100px]">Etiquetas</th>
                <th class="px-4 py-3 text-left resize-x overflow-auto min-w-[120px]">Fecha</th>
                <th class="px-4 py-3 text-left resize-x overflow-auto min-w-[160px]">Categoría</th>
                <th class="px-4 py-3 text-left resize-x overflow-auto min-w-[160px]">Acciones</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-base-300 text-sm">
              @for (item of tareasFiltradas; track item.tarea) {
              <tr
                class="hover:bg-primary/10 transition duration-200 ease-in-out @if (item.categoria === 'Sin empezar') { 'bg-gray-200' } @else if (item.categoria === 'En progreso') { 'bg-blue-100' } @else if (item.categoria === 'Completada') { 'bg-green-100' } @else { 'bg-white' }">
                <!-- Columna Título -->
                <td class="px-4 py-3 font-medium truncate max-w-[200px]">
                  {{ item.tarea.title }}
                </td>

                <!-- Columna Responsables -->
                <td class="px-4 py-3 truncate max-w-[200px]">
                  @if (item.tarea.assignee && item.tarea.assignee.length > 0) {
                  <span class="text-sm text-white">
                    {{ getNombreResponsables(item.tarea.assignee) }}
                  </span>
                  } @else {
                  <span class="text-sm text-gray-400 italic flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                      stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round"
                        d="M15 12H9m6-6a6 6 0 11-12 0 6 6 0 0112 0zM21 12a9 9 0 10-18 0 9 9 0 0018 0z" />
                    </svg>
                    Sin responsables
                  </span>
                  }
                </td>

                <!-- Columna Etiquetas -->
                <td class="px-4 py-3">
                  @if (item.tarea.etiquetas && item.tarea.etiquetas.length > 0) {
                  <div class="flex gap-2 flex-wrap">
                    @for (etiqueta of getNombresEtiquetas(item.tarea.etiquetas); track etiqueta) {
                    <span class="badge py-1 px-3 rounded-full text-xs font-semibold">
                      {{ etiqueta }}
                    </span>
                    }
                  </div>
                  } @else {
                  <div class="text-gray-400 italic">Sin etiquetas</div>
                  }
                </td>

                <!-- Columna Fecha -->
                <td class="px-4 py-3 whitespace-nowrap truncate max-w-[120px]">
                  @if (!item.tarea.dueDate) {
                  <span class="text-gray-400 italic">Sin fecha límite</span>
                  } @else {
                  {{ item.tarea.dueDate | date : 'dd/MM/yyyy' }}
                  }
                </td>

                <!-- Columna Categoría -->
                <td class="px-4 py-3 text-sm font-medium text-white truncate max-w-[150px]">
                  {{ item.categoria }}
                </td>

                <!-- Columna Acciones -->
                <td class="px-4 py-3 flex justify-center gap-2">
                  <!-- Botón editar tarea (ícono de lápiz) -->
                  <button
                    class="p-2 rounded-full bg-opacity-60 bg-gray-800 text-white hover:bg-opacity-80 hover:bg-blue-600 transition-opacity duration-200 ease-in-out shadow-md"
                    (click)="editarTarea(item.tarea.id)" aria-label="Editar tarea">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                      stroke="currentColor" class="h-5 w-5">
                      <path stroke-linecap="round" stroke-linejoin="round"
                        d="M13.125 6.375l4.5 4.5m0 0l-7.5 7.5h-4.5v-4.5l7.5-7.5m0 0l2.25-2.25a1.125 1.125 0 0 1 1.594 1.594L13.125 6.375z" />
                    </svg>
                  </button>

                  <!-- Botón eliminar tarea (ícono de basurero) -->
                  <button
                    class="p-2 rounded-full bg-opacity-60 bg-gray-800 text-white hover:bg-opacity-80 hover:bg-red-600 transition-opacity duration-200 ease-in-out shadow-md"
                    (click)="eliminarTarea(item.tarea.id)" aria-label="Eliminar tarea">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                      stroke="currentColor" class="h-5 w-5">
                      <path stroke-linecap="round" stroke-linejoin="round"
                        d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                    </svg>
                  </button>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
    }

    <!-- VISTA TAREAS ASIGNADAS   @for (item of tareasAsignadasFiltradas; track item.tarea.id) { -->
    @if (viewMode === 'assigned') {

    <div #listContainer class="flex flex-col w-full gap-6 animate-fadeIn transition-opacity duration-500 ease-in-out">
      <!-- Tabla de tareas -->
      <div class="w-full overflow-x-auto rounded-xl shadow border border-base-300">
        <table class="table table-zebra bg-base-200 rounded-xl text-sm animate-fadeIn">
          <thead class="bg-primary text-primary-content text-xs uppercase select-none">
            <tr>
              <th class="px-6 py-3 text-left resize-x overflow-auto min-w-[120px]">Título</th>
              <th class="px-6 py-3 text-left resize-x overflow-auto min-w-[160px]">Responsables</th>
              <th class="px-6 py-3 text-left resize-x overflow-auto min-w-[100px]">Etiquetas</th>
              <th class="px-6 py-3 text-left resize-x overflow-auto min-w-[120px]">Fecha</th>
              <th class="px-6 py-3 text-left resize-x overflow-auto min-w-[160px]">Categoría</th>
              <th class="px-6 py-3 text-left resize-x overflow-auto min-w-[160px]">Acciones</th>
              <!-- Columna para las etiquetas -->
            </tr>
          </thead>
          <tbody class="divide-y divide-base-300 text-sm">
            @for (item of tareasAsignadasFiltradas; track item.tarea.id) {
            <tr class="hover:bg-primary/10 transition duration-200 ease-in-out">
              <!-- Columna Título -->
              <td class="px-6 py-3 font-medium truncate">{{ item.tarea.title }}</td>

              <!-- Columna Responsables -->
              <td class="px-6 py-3">
                @if (item.tarea.assignee && item.tarea.assignee.length > 0) {
                <span class="text-sm text-white">
                  {{ getNombreResponsables(item.tarea.assignee) }}
                </span>
                } @else {
                <span class="text-sm text-gray-400 italic flex items-center gap-1">
                  <!-- Heroicon: User Minus -->
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                      d="M15 12H9m6-6a6 6 0 11-12 0 6 6 0 0112 0zM21 12a9 9 0 10-18 0 9 9 0 0018 0z" />
                  </svg>
                  Sin responsables
                </span>
                }
              </td>

              <!-- Columna Etiquetas -->
              <td class="px-6 py-3">
                @if (item.tarea.etiquetas && item.tarea.etiquetas.length > 0) {
                <div>
                  @for (etiqueta of getNombresEtiquetas(item.tarea.etiquetas); track etiqueta) {
                  <span class="badge" [ngClass]="{
                      Alta: etiqueta === 'Alta',
                      Media: etiqueta === 'Media',
                      Baja: etiqueta === 'Baja'
                    }">
                    {{ etiqueta }}
                  </span>
                  }
                </div>
                } @else {
                <div class="text-gray-400 italic">Sin etiquetas</div>
                }
              </td>

              <!-- Columna Prioridad -->
              <td class="px-6 py-3 whitespace-nowrap">
                {{ item.tarea.dueDate | date : 'dd/MM/yyyy' }}
              </td>

              <!-- Columna Categoría -->
              <td class="px-6 py-3 text-sm font-medium text-white">
                {{ item.categoria }}
              </td>
              <td>
                <!-- Contenedor de botones (editar y eliminar) -->
                <div>
                  <!-- Botón editar tarea (ícono de lápiz) -->
                  <button
                    class="p-2 rounded-full bg-opacity-60 bg-gray-800 text-white hover:bg-opacity-80 hover:bg-blue-600 transition-opacity duration-200 ease-in-out"
                    (click)="editarTarea(item.tarea.id)" aria-label="Editar tarea"
                    style="box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15)">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                      stroke="currentColor" class="h-5 w-5">
                      <path stroke-linecap="round" stroke-linejoin="round"
                        d="M13.125 6.375l4.5 4.5m0 0l-7.5 7.5h-4.5v-4.5l7.5-7.5m0 0l2.25-2.25a1.125 1.125 0 0 1 1.594 1.594L13.125 6.375z" />
                    </svg>
                  </button>
                  -
                  <!-- Botón eliminar tarea (ícono de basurero) -->
                  <button
                    class="p-2 rounded-full bg-opacity-60 bg-gray-800 text-white hover:bg-opacity-80 hover:bg-red-600 transition-opacity duration-200 ease-in-out"
                    (click)="eliminarTarea(item.tarea.id)" aria-label="Eliminar tarea"
                    style="box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15)">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                      stroke="currentColor" class="h-5 w-5">
                      <path stroke-linecap="round" stroke-linejoin="round"
                        d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
    }
  </main>

  <!-- Modal Nueva Tarea -->
  <dialog id="modalNuevaTarea" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4"
    [open]="modalVisible">
    <form method="dialog" (submit)="crearTarea($event)"
      class="modal-box max-w-lg w-full p-6 bg-base-100 rounded-lg shadow-lg">
      <h3 class="font-bold text-lg mb-4">Crear Nueva Tarea</h3>

      <!-- Título -->
      <label class="label">
        <span class="label-text font-semibold">Título *</span>
      </label>
      <input type="text" placeholder="Ej: Redactar propuesta comercial" [(ngModel)]="newTask.titulo" name="titulo"
        class="input input-bordered w-full mb-4" [ngClass]="{ 'border-red-500': errores.titulo }" required />

      <!-- Mensaje de error para el título -->
      @if (errores.titulo) {
      <div class="text-red-500 text-sm mt-1">El título es obligatorio</div>
      }
      <!-- Fecha límite -->
      <label class="label">
        <span class="label-text font-semibold">Fecha límite</span>
      </label>
      <input type="date" [(ngModel)]="newTask.fechaLimite" name="fechaLimite"
        class="input input-bordered w-full mb-4" />

      <!-- Responsables -->
      <label class="label">
        <span class="label-text font-semibold">Responsables</span>
      </label>
      <select multiple [(ngModel)]="newTask.responsablesIds" name="responsables"
        class="select select-bordered w-full mb-4">
        @for (miembro of miembrosDelProyecto; track miembro.usuario.id) {
        <option [value]="miembro.usuario.id">
          {{ miembro.usuario.nombre }} {{ miembro.usuario.apellido }}
        </option>
        }
      </select>

      <!-- Etiquetas -->
      <label class="label">
        <span class="label-text font-semibold">Etiquetas</span>
      </label>
      <select multiple [(ngModel)]="newTask.etiquetaIds" name="etiquetas" class="select select-bordered w-full mb-4">
        @for (etiqueta of etiquetasUnicas; track etiqueta.id) {
        <option [value]="etiqueta.id">
          {{ etiqueta.nombre }}
        </option>
        }
      </select>

      <!-- Acciones -->
      <div class="modal-action flex justify-end gap-3 mt-6">
        <button type="button" (click)="cerrarModal()" class="btn btn-outline btn-error">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary">Crear</button>
      </div>
    </form>
  </dialog>
</div>