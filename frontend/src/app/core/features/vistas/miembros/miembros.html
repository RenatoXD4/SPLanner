<div class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white flex">

  <!-- Sidebar -->
  <app-sidebar [class.hidden]="!mostrarSidebar"></app-sidebar>

  <!-- Contenido Principal -->
  <div class="flex-1 flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-slate-800/50 border-b border-slate-700 p-6 sticky top-0 z-40 backdrop-blur-sm">
      <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
        <div>
          <h1 class="text-2xl font-bold text-white">Proyectos Compartidos</h1>
          <p class="text-slate-400 mt-1 text-sm">Proyectos a los que fuiste invitado como miembro</p>
        </div>

        <div class="flex flex-col sm:flex-row gap-3 w-full lg:w-auto">
          <app-notificacion class="transition-all duration-500 ease-out delay-300"
            [class]="!loading? 'opacity-100 translate-x-0' : ' translate-x-0'">
          </app-notificacion>
          <!-- Barra de búsqueda -->
          <div class="relative flex-1">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <svg class="h-4 w-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
            </div>
            <input type="text" placeholder="Buscar proyectos compartidos..." [(ngModel)]="filtroTexto"
              (input)="onFiltroChange()"
              class="pl-10 pr-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 w-full focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
          </div>

          <!-- Filtro por rol -->
          <div class="relative">
            <select [(ngModel)]="filtroRol" (change)="onFiltroChange()"
              class="bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent appearance-none pr-8">
              <option value="">Todos los roles</option>
              <option value="Administrador">Administrador</option>
              <option value="Editor">Editor</option>
              <option value="Visualizador">Visualizador</option>
            </select>
            <div class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
              <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Contenido de Proyectos -->
    <main class="flex-1 p-4 lg:p-6 overflow-auto">

      <!-- Estadísticas rápidas -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-4 border border-slate-700">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-slate-400 text-sm">Total de proyectos</p>
              <p class="text-2xl font-bold text-white">{{ proyectosFiltrados.length }}</p>
            </div>
            <div class="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center">
              <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
              </svg>
            </div>
          </div>
        </div>

        <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-4 border border-slate-700">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-slate-400 text-sm">Como administrador</p>
              <p class="text-2xl font-bold text-white">{{ contarProyectosPorRol('Administrador') }}</p>
            </div>
            <div class="w-10 h-10 bg-red-500/20 rounded-lg flex items-center justify-center">
              <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
              </svg>
            </div>
          </div>
        </div>

        <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-4 border border-slate-700">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-slate-400 text-sm">Como editor/visualizador</p>
              <p class="text-2xl font-bold text-white">{{ contarProyectosPorRol('Editor') +
                contarProyectosPorRol('Visualizador') }}</p>
            </div>
            <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center">
              <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Grid de Proyectos -->
      @if (proyectosFiltrados.length > 0) {
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
        @for (p of proyectosFiltrados; track p.id) {
        <div
          class="bg-gradient-to-br from-slate-800 to-slate-800/80 rounded-2xl p-5 border border-slate-700 hover:border-purple-500 cursor-pointer transition-all duration-300 hover:shadow-xl group backdrop-blur-sm relative overflow-hidden">

          <!-- Efecto de brillo al hover -->
          <div
            class="absolute inset-0 bg-gradient-to-r from-purple-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300">
          </div>

          <!-- Header de la tarjeta -->
          <div class="flex items-start justify-between mb-4 relative z-10">
            <div class="flex-1" (click)="irAlBoard(p.id ?? '')">
              <div class="flex items-center gap-2 mb-2">
                <h3
                  class="text-lg font-bold text-white truncate group-hover:text-purple-300 transition-colors duration-200">
                  {{ p.nombre }}
                </h3>
                <!-- Indicador de proyecto compartido -->
                <div class="w-2 h-2 bg-purple-500 rounded-full animate-pulse"></div>
              </div>
              <p class="text-slate-400 text-sm line-clamp-2 min-h-[40px]">
                {{ p.descripcion || 'Sin descripción' }}
              </p>
            </div>

            <!-- Badge de Rol -->
            <div class="ml-3">
              @if (obtenerRolProyecto(p.id) === 'Administrador') {
              <span
                class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-red-500/20 text-red-400 border border-red-500/30 backdrop-blur-sm">
                <span class="w-1.5 h-1.5 bg-red-400 rounded-full mr-1.5"></span>
                Administrador
              </span>
              } @else if (obtenerRolProyecto(p.id) === 'Editor') {
              <span
                class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-green-500/20 text-green-400 border border-green-500/30 backdrop-blur-sm">
                <span class="w-1.5 h-1.5 bg-green-400 rounded-full mr-1.5"></span>
                Editor
              </span>
              } @else {
              <span
                class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-blue-500/20 text-blue-400 border border-blue-500/30 backdrop-blur-sm">
                <span class="w-1.5 h-1.5 bg-blue-400 rounded-full mr-1.5"></span>
                Visualizador
              </span>
              }
            </div>
          </div>

          <!-- Información del proyecto -->
          <div class="space-y-3 mt-4 text-sm relative z-10" (click)="irAlBoard(p.id ?? '')">
            <div class="flex items-center justify-between">
              <span class="text-slate-400 flex items-center gap-1.5">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                Creado por:
              </span>
              <span class="text-white font-medium">{{ p.creadoPor?.nombre || 'Usuario' }}</span>
            </div>

            <div class="flex items-center justify-between">
              <span class="text-slate-400 flex items-center gap-1.5">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                Fecha:
              </span>
              <span class="text-slate-300">{{ p.createdAt | date:'mediumDate' }}</span>
            </div>

            <!-- Miembros del proyecto -->
            <div class="flex items-center justify-between">
              <span class="text-slate-400 flex items-center gap-1.5">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z" />
                </svg>
                Miembros:
              </span>
              <div class="flex items-center gap-1">
                <span class="text-white">{{ p.miembrosCount || 0 }}</span>
              </div>
            </div>

            <!-- Tu rol en el proyecto -->
            <div class="flex items-center justify-between">
              <span class="text-slate-400 flex items-center gap-1.5">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                </svg>
                Tu rol:
              </span>
              <span class="text-purple-400 font-medium">{{ obtenerRolProyecto(p.id) }}</span>
            </div>
          </div>

          <!-- Footer de la tarjeta -->
          <div class="mt-5 pt-4 border-t border-slate-700 flex items-center justify-between relative z-10">
            <div class="flex items-center gap-2 text-purple-400 text-sm">
              <div class="relative">
                <div class="w-2 h-2 bg-purple-400 rounded-full animate-ping absolute"></div>
                <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
              </div>
              <span>Activo</span>
            </div>

            <div class="flex gap-2">
              <!-- Botón para ver detalles -->
              <button (click)="verDetallesProyecto(p); $event.stopPropagation()"
                class="text-slate-400 hover:text-white hover:bg-slate-700/50 p-2 rounded-lg transition-all duration-200"
                title="Ver detalles">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </button>

              <!-- Botón principal para abrir proyecto -->
              <button (click)="irAlBoard(p.id ?? ''); $event.stopPropagation()"
                class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center gap-1.5 group-hover:scale-105 shadow-lg">
                Abrir Proyecto
                <svg class="w-4 h-4 transform group-hover:translate-x-0.5 transition-transform duration-200" fill="none"
                  stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                </svg>
              </button>
            </div>
          </div>
        </div>
        }
      </div>
      } @else {
      <!-- Estado vacío -->
      <div class="flex-1 flex items-center justify-center py-12">
        <div class="max-w-md mx-auto text-center">
          <div
            class="w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-slate-800 to-slate-700 rounded-2xl flex items-center justify-center shadow-lg">
            <svg class="w-10 h-10 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z" />
            </svg>
          </div>
          <h3 class="text-2xl font-bold text-white mb-3">No tienes proyectos compartidos</h3>
          <p class="text-slate-400 mb-6">No te han invitado a proyectos de otros usuarios</p>
          <div
            class="space-y-3 text-sm text-slate-400 bg-slate-800/50 backdrop-blur-sm rounded-xl p-4 border border-slate-700">
            <p class="flex items-center gap-2">
              <svg class="w-4 h-4 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              Tus proyectos propios aparecen en "Mis Proyectos"
            </p>
            <p class="flex items-center gap-2">
              <svg class="w-4 h-4 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
              </svg>
              Aquí solo ves proyectos de otros usuarios donde te invitaron
            </p>
          </div>
        </div>
      </div>
      }
    </main>
  </div>

  <!-- Modal de Detalles del Proyecto -->
  <ng-container #detallesContainer></ng-container>
  <ng-template #detallesTemplate>
    @if (detallesAbierto && proyectoDetalles) {
    <div class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fade-in"
      (click)="cerrarDetalles()">
      <div (click)="$event.stopPropagation()"
        class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl w-full max-w-lg border border-slate-700 shadow-2xl transform transition-all duration-300 animate-scale-in">

        <!-- Header con gradiente -->
        <div
          class="bg-gradient-to-r from-purple-900/50 to-purple-800/30 rounded-t-2xl p-6 border-b border-purple-700/50">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
              <div
                class="w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <div>
                <h2 class="text-xl font-bold text-white">Detalles del Proyecto</h2>
                <p class="text-purple-300 text-sm">Información completa del proyecto compartido</p>
              </div>
            </div>
            <button (click)="cerrarDetalles()"
              class="w-8 h-8 bg-slate-700 hover:bg-slate-600 rounded-lg flex items-center justify-center transition-all duration-200 hover:scale-110">
              <svg class="w-4 h-4 text-slate-400 hover:text-white" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        </div>

        <!-- Contenido -->
        <div class="p-6 space-y-6">
          <!-- Información principal -->
          <div class="space-y-4">
            <div>
              <h3 class="text-lg font-semibold text-white mb-2">{{ proyectoDetalles.nombre }}</h3>
              <p class="text-slate-300 bg-slate-700/30 rounded-lg p-3 border border-slate-600">
                {{ proyectoDetalles.descripcion || 'Este proyecto no tiene descripción' }}
              </p>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div class="bg-slate-700/30 rounded-lg p-3 border border-slate-600">
                <p class="text-slate-400 text-sm">Tu rol</p>
                <p class="text-purple-400 font-semibold">{{ obtenerRolProyecto(proyectoDetalles.id) }}</p>
              </div>
              <div class="bg-slate-700/30 rounded-lg p-3 border border-slate-600">
                <p class="text-slate-400 text-sm">Total de miembros</p>
                <p class="text-white font-semibold">{{ proyectoDetalles.miembrosCount || 0 }}</p>
              </div>
            </div>
          </div>

          <!-- Información adicional -->
          <div class="space-y-3">
            <h4 class="text-md font-medium text-white">Información del Proyecto</h4>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-slate-400">Creado por:</span>
                <span class="text-white">{{ proyectoDetalles.creadoPor?.nombre || 'Usuario' }}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Fecha de creación:</span>
                <span class="text-slate-300">{{ proyectoDetalles.createdAt | date:'fullDate' }}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Última actualización:</span>
                <span class="text-slate-300">{{ proyectoDetalles.updatedAt | date:'medium' }}</span>
              </div>
            </div>
          </div>

          <!-- Acciones -->
          <div class="flex space-x-3 pt-4">
            <button (click)="cerrarDetalles()"
              class="flex-1 bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-xl font-semibold transition-all duration-200 border border-slate-600 hover:border-slate-500 backdrop-blur-sm">
              Cerrar
            </button>
            <button (click)="irAlBoard(proyectoDetalles.id ?? ''); cerrarDetalles()"
              class="flex-1 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white py-3 rounded-xl font-semibold transition-all duration-200 transform hover:scale-[1.02] shadow-lg flex items-center justify-center space-x-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
              </svg>
              <span>Abrir Proyecto</span>
            </button>
          </div>
        </div>
      </div>
    </div>
    }
  </ng-template>

  <!-- Mensajes Toast -->
  <ng-container #mensajeContainer></ng-container>
  <ng-template #mensajeTemplate let-msg>
    <div class="fixed top-4 right-4 z-50 animate-slide-in-right">
      <div
        class="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-6 py-4 rounded-xl shadow-2xl font-medium backdrop-blur-sm border border-purple-400/20">
        <div class="flex items-center space-x-3">
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
          <span>{{ msg }}</span>
        </div>
      </div>
    </div>
  </ng-template>

</div>